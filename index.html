<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Controle de Funcionários</title>
<style>
body {
    font-family: Arial;
    background: #f4f4f4;
    padding: 20px;
}
.container {
    background: white;
    padding: 20px;
    border-radius: 10px;
    max-width: 900px;
    margin: auto;
    display: flex;
    gap: 20px;
}
.lista {
    width: 30%;
    border-right: 1px solid #ddd;
    padding-right: 10px;
}
.lista button {
    width: 100%;
    margin-bottom: 5px;
}
.detalhes {
    width: 70%;
}
button {
    padding: 8px;
    cursor: pointer;
}
input {
    padding: 6px;
    width: 100%;
    margin-bottom: 5px;
}
.registro {
    border-bottom: 1px solid #ddd;
    padding: 5px 0;
}
.saldo {
    font-size: 20px;
    font-weight: bold;
}
.negativo { color: red; }
.positivo { color: green; }
.zero { color: black; }
</style>
</head>
<body>

<div class="container">

<div class="lista">
    <h3>Funcionários</h3>
    <input type="text" id="nome" placeholder="Novo Funcionário">
    <button onclick="criarFuncionario()">Criar</button>
    <hr>
    <div id="listaFuncionarios"></div>
</div>

<div class="detalhes" id="areaFuncionario" style="display:none;">
    <h3 id="nomeFuncionario"></h3>
    <div class="saldo" id="saldo"></div>

    <button onclick="adicionarVale()">Vale / Adiantamento</button>
    <button onclick="registrarPagamento()">Registrar Pagamento</button>
    <button onclick="zerarConta()">Zerar Conta</button>

    <h4>Histórico Individual</h4>
    <div id="historico"></div>
</div>

</div>

<script>
let funcionarios = JSON.parse(localStorage.getItem("funcionarios")) || [];
let funcionarioAtual = null;

function salvar() {
    localStorage.setItem("funcionarios", JSON.stringify(funcionarios));
}

function criarFuncionario() {
    const nome = document.getElementById("nome").value;
    if (!nome) return alert("Digite o nome");

    funcionarios.push({
        nome: nome,
        movimentacoes: []
    });

    document.getElementById("nome").value = "";
    salvar();
    renderLista();
}

function selecionarFuncionario(index) {
    funcionarioAtual = index;
    renderDetalhes();
}

function adicionarVale() {
    const valor = parseFloat(prompt("Digite o valor do vale:"));
    if (!valor || valor <= 0) return;

    funcionarios[funcionarioAtual].movimentacoes.push({
        tipo: "Vale / Adiantamento",
        valor: valor,
        data: new Date().toLocaleDateString()
    });

    salvar();
    renderDetalhes();
}

function registrarPagamento() {
    const valor = parseFloat(prompt("Digite o valor do pagamento:"));
    if (!valor || valor <= 0) return;

    funcionarios[funcionarioAtual].movimentacoes.push({
        tipo: "Pagamento",
        valor: -valor,
        data: new Date().toLocaleDateString()
    });

    salvar();
    renderDetalhes();
}

function zerarConta() {
    const saldo = calcularSaldo();
    if (saldo === 0) {
        alert("Saldo já está zerado.");
        return;
    }

    if (!confirm(`Tem certeza que deseja zerar o saldo de R$ ${saldo.toFixed(2)}?`)) {
        return;
    }

    funcionarios[funcionarioAtual].movimentacoes.push({
        tipo: "Quitação Automática",
        valor: -saldo,
        data: new Date().toLocaleDateString()
    });

    salvar();
    renderDetalhes();
}

function excluirRegistro(index) {
    if (!confirm("Deseja excluir este registro?")) return;
    funcionarios[funcionarioAtual].movimentacoes.splice(index, 1);
    salvar();
    renderDetalhes();
}

function calcularSaldo() {
    return funcionarios[funcionarioAtual].movimentacoes
        .reduce((total, mov) => total + mov.valor, 0);
}

function renderLista() {
    const listaDiv = document.getElementById("listaFuncionarios");
    listaDiv.innerHTML = "";

    funcionarios.forEach((func, index) => {
        const btn = document.createElement("button");
        btn.innerText = func.nome;
        btn.onclick = () => selecionarFuncionario(index);
        listaDiv.appendChild(btn);
    });
}

function renderDetalhes() {
    if (funcionarioAtual === null) return;

    document.getElementById("areaFuncionario").style.display = "block";
    document.getElementById("nomeFuncionario").innerText = funcionarios[funcionarioAtual].nome;

    const saldo = calcularSaldo();
    const saldoDiv = document.getElementById("saldo");

    saldoDiv.innerText = "Saldo Atual: R$ " + saldo.toFixed(2);

    saldoDiv.className = "saldo " +
        (saldo > 0 ? "negativo" : saldo < 0 ? "positivo" : "zero");

    const historicoDiv = document.getElementById("historico");
    historicoDiv.innerHTML = "";

    funcionarios[funcionarioAtual].movimentacoes.forEach((mov, index) => {
        const div = document.createElement("div");
        div.className = "registro";
        div.innerHTML = `
            ${mov.data} - ${mov.tipo}: R$ ${mov.valor.toFixed(2)}
            <button onclick="excluirRegistro(${index})">Excluir</button>
        `;
        historicoDiv.appendChild(div);
    });
}

renderLista();
</script>

</body>
</html>
